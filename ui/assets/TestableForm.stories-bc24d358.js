var I=Object.defineProperty;var C=(s,e,t)=>e in s?I(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var a=(s,e)=>I(s,"name",{value:e,configurable:!0});var h=(s,e,t)=>(C(s,typeof e!="symbol"?e+"":e,t),t);import{j as c}from"./jsx-runtime-91e341d4.js";import{B as A}from"./Button-12c95ded.js";import{p as m,c as k,a as $,u as O,r as D,e as H,h as Z,I as F,F as U}from"./InputWrapper-9c7d1173.js";import{T as N}from"./TextInput-146ae76c.js";import{P as Y}from"./PasswordInput-211251f9.js";import{S as J}from"./SelectInput-f9d9ae5a.js";import{u as T}from"./styled-components.browser.esm-dd68fb2f.js";import{r as W}from"./index-b56a0300.js";import"./index-8d138fa4.js";import"./Icon.hoc-1b9291aa.js";import"./Symbols.hoc-fb0f215f.js";import"./index-17b0cd16.js";import"./index-6925154b.js";import"./Button.constants-c6e6f0a7.js";import"./devices-f8e8a791.js";import"./launch-outline-16-2a071c4c.js";import"./warning-solid-24-62e98cc2.js";import"./LoadingEllipsis-859301b8.js";import"./IconButton-c662f5de.js";import"./eye-visible-solid-24-51ef0235.js";import"./chevron-down-solid-16-ecd33624.js";import"./_commonjsHelpers-c38d1a10.js";const b=a(({children:s,...e})=>{const r=a(i=>{i.preventDefault()},"preventSubmission");return c.jsx("form",{noValidate:!0,onSubmit:r,...e,children:s})},"Form$1");try{b.displayName="Form",b.__docgenInfo={description:"",displayName:"Form",props:{}}}catch{}const d=a(({type:s,condition:e,message:t,messageBuilder:r})=>e?null:{type:s,message:t,messageBuilder:r},"handler"),z=a(()=>({validate:s=>{const t=m(s).length>0;return d({type:"required",condition:t,message:"Field is required",messageBuilder:r=>`${r} is required`})}}),"isNotEmpty"),G=a(()=>({validate:s=>{const t=typeof m(s)=="string";return d({type:"isString",condition:t,message:"Field must be text only",messageBuilder:r=>`${r} must be text only`})}}),"isString"),K=a(()=>({validate:s=>{const e=!isNaN(s);return d({type:"isNumber",condition:e,message:"Field must be a number",messageBuilder:t=>`${t} must be a number`})}}),"isNumber"),Q=a(()=>({validate:s=>{const e=m(s),r=new RegExp(/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i).test(e);return d({type:"isEmail",condition:r,message:"Please enter a valid email address",messageBuilder:()=>"Please enter a valid email address"})}}),"isEmail"),X=a(s=>({validate:(e,t)=>{const i=m(e)===t[s];return d({type:"doesMatch",condition:i,message:"Fields must match",messageBuilder:n=>`${n} fields must match`})}}),"doesMatch"),L=a((s,e)=>({validate:t=>{const r=m(t),i=k(r,e),n={type:`hasMin${$(e||"")}`,condition:i>=s};return d(e?{...n,message:`Must contain minimum ${s} ${e}`,messageBuilder:()=>`Must contain minimum ${s} ${e}`}:{...n,message:`Minimum length is ${s} characters`,messageBuilder:()=>`Minimum length is ${s} characters`})}}),"hasMin"),ee=a((s,e)=>({validate:t=>{const r=m(t),i=k(r,e),n={type:`hasMax${$(e||"")}`,condition:i<=s};return d(e?{...n,message:`Must contain maximum ${s} ${e}`,messageBuilder:()=>`Must contain maximum ${s} ${e}`}:{...n,message:`Maximum length is ${s} characters`,messageBuilder:()=>`Maximum length is ${s} characters`})}}),"hasMax"),se=a((s,e,t)=>({validate:r=>{const i=Number(r),n={type:`hasRange${$(t||"")}`,condition:i>=s&&i<=e};return d(t?{...n,message:`Must contain a minimum value of ${s} ${t} and a maximum value of ${e} ${t}`,messageBuilder:()=>`Must contain a minimum value of ${s} ${t} and a maximum value of ${e} ${t}`}:{...n,message:`Minimum value is ${s} characters and maximum value is ${e} characters`,messageBuilder:()=>`Minimum value is ${s} characters and maximum value is ${e} characters`})}}),"hasRange"),te=a(()=>({validate:s=>{const t={type:"containsNoSpaces",condition:!m(s).includes(" ")};return d({...t,message:"Must not contain any spaces",messageBuilder:()=>"Must not contain any spaces"})}}),"containsNoSpaces"),re=a(s=>({validate:e=>{const t=m(e),r={type:"matchesRegex",condition:s.test(t)};return d({...r,message:"Field does not match the required format",messageBuilder:()=>"Field does not match the required format"})}}),"matchesRegex"),ae=a(s=>({validate:async e=>{const t=m(e),r={type:"hasCustomValidation",condition:await(async()=>{try{return await s(t)}catch{return!1}})()};return d({...r,message:"Field does not pass the custom validation",messageBuilder:()=>"Field does not pass the custom validation"})}}),"hasCustomValidation"),_=[];class j{constructor(e){h(this,"name");h(this,"isRequired",!1);h(this,"validators",[]);this.name=e}initialise(e){this.validators=e}checkValid(){if(!this.validators.length)throw new Error("No validators set")}string(){return this.initialise([[G,_]]),this}number(){return this.initialise([[K,_]]),this}required(){return this.isRequired=!0,this}isEmail(...e){return this.checkValid(),this.validators.push([Q,e]),this}doesMatch(...e){return this.checkValid(),this.validators.push([X,e]),this}hasMin(...e){return this.checkValid(),this.validators.push([L,e]),this}hasMax(...e){return this.checkValid(),this.validators.push([ee,e]),this}hasRange(...e){return this.checkValid(),this.validators.push([se,e]),this}containsNoSpaces(...e){return this.checkValid(),this.validators.push([te,e]),this}matchesRegex(...e){return this.checkValid(),this.validators.push([re,e]),this}hasCustomValidation(...e){return this.checkValid(),this.validators.push([ae,e]),this}}a(j,"SchemaEntry");class g{constructor(e){h(this,"self");h(this,"fields");h(this,"names");h(this,"errors",{});return this.self=e,this.fields=Object.keys(e),this.names=Object.entries(e).reduce((t,[r,i])=>({...t,[r]:i.name}),{}),this}static add(e){return new j(e)}get(e){return this.self[e]}getErrors(e){return this.errors[e]}setErrors(e,t){!t||t.length===0?delete this.errors[e]:this.errors[e]=t}async validate(e,t,r){const i=this.get(e);if(!i)return;const n=i.isRequired,p=await z().validate(t,r);if(n&&p)return this.setErrors(e,[p]),this.getErrors(e);const V=(await Promise.all(i.validators.map(async v=>{const[S,M]=v;return await S(...M).validate(t,r)}))).filter(v=>v);return this.setErrors(e,V),this.getErrors(e)}}a(g,"Schema");const ie=T.div.withConfig({componentId:"sc-1l9mewf-0"})(["width:500px;padding:","px;"],({theme:s})=>s.spacing.x2),oe=a((s,e={})=>{if(!s)throw new Error("No schema provided! Please provide a schema to useIndyForm");const t=O({mode:"onTouched",resolver:D(s),...e}),{formState:r,getValues:i,setError:n}=t;W.useEffect(()=>{const o=s.fields,u=Object.keys(i()),l=o.filter(f=>!u.includes(f));if(l.length>0)throw new Error(`Fields ["${l.join('", "')}"] are included in the schema but missing or inaccessible by React Hook Form`)},[i,s.fields]);const p=a(o=>{const l=r.errors[o];if(l)return l[0].messageBuilder(s.names[o])},"getTextInputError"),y=a(o=>{const u=!!r.errors.root,l=!!r.errors[o],f=r.dirtyFields[o]&&!l;return l||u?F.ERROR:f?F.SUCCESS:F.DEFAULT},"getTextInputState");return{registerControlledInput:a(o=>{var w;const u=((w=s.get(o))==null?void 0:w.isRequired)||!1,l=p(o),f=y(o);return{id:o,state:f,message:l,required:u,"aria-required":u,"aria-invalid":l==="error","aria-describedby":`${H(o)} ${Z(o)}`}},"registerControlledInput"),methods:{...t,setFormError:a(o=>{n("root",{message:o})},"setFormError"),setFieldError:a((o,u)=>{n(o,{message:u},{shouldFocus:!0})},"setFieldError"),getFormError:a(()=>p("root"),"getFormError"),getFieldErrors:a(()=>s.fields.map(p).filter(Boolean),"getFieldErrors")},formState:{...r,errors:r.errors}}},"useIndyForm"),ne=new g({fullName:g.add("Full name").string(),email:g.add("Email address").string().isEmail().required(),password:g.add("Password").string().hasMin(1,"digits").hasMin(6,"letters").required(),birthYear:g.add("Birth year").number().required()}),x=a(({onSubmit:s})=>{const{methods:e,registerControlledInput:t}=oe(ne),{handleSubmit:r,formState:i}=e;return c.jsx(ie,{children:c.jsx(U,{...e,children:c.jsxs(b,{children:[c.jsx(N,{label:"Name",...t("fullName")}),c.jsx(N,{type:"email",label:"Email address",helpText:"Add an email address",...t("email")}),c.jsx(Y,{label:"Password",helpText:"Make it a good one",...t("password")}),c.jsx(J,{label:"Birth year",options:[{value:"1970",label:"1970"},{value:"1980",label:"1980"},{value:"1990",label:"1990"}],...t("birthYear")}),c.jsx(A,{type:"submit",disabled:!i.isValid,onClick:r(s),children:"Sign up"})]})})})},"TestableForm"),de=x;try{x.displayName="TestableForm",x.__docgenInfo={description:`This form exists to demonstrate how to use the useIndyForm hook
alongside the Form, TextInput and PasswordInput components

It us also used for testing functionality in a form context
with full validation and error handling, and providing a
component in storybook for visual testing`,displayName:"TestableForm",props:{onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!0,type:{name:"SubmitHandler<ExampleFormData>"}}}}}catch{}const le={onSubmit:s=>alert(`Submitted: ${JSON.stringify(s)}`)},qe={title:"Modules/Form",component:de},E={args:le};var B,R,q;E.parameters={...E.parameters,docs:{...(B=E.parameters)==null?void 0:B.docs,source:{originalSource:`{
  args: defaultArgs
}`,...(q=(R=E.parameters)==null?void 0:R.docs)==null?void 0:q.source}}};const ke=["Default"];export{E as Default,ke as __namedExportsOrder,qe as default};
//# sourceMappingURL=TestableForm.stories-bc24d358.js.map
